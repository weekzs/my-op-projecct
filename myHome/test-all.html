<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½éª‘è¡ŒåŠ©æ‰‹ - åŠŸèƒ½æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
        }
        
        .test-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .test-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .test-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-btn.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .test-btn.warning {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .test-btn.error {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }
        
        .status {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        
        .console-log {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .console-log.info {
            color: #17a2b8;
        }
        
        .console-log.success {
            color: #28a745;
        }
        
        .console-log.warning {
            color: #ffc107;
        }
        
        .console-log.error {
            color: #dc3545;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .summary h2 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            text-align: center;
        }
        
        .stat-item {
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš´â€â™‚ï¸ æ™ºèƒ½éª‘è¡ŒåŠ©æ‰‹</h1>
            <p>å…¨é¢åŠŸèƒ½æµ‹è¯•ä¸æ¼æ´æ£€æµ‹</p>
        </div>
        
        <!-- æµ‹è¯•ç»Ÿè®¡ -->
        <div class="summary">
            <h2>ğŸ“Š æµ‹è¯•ç»Ÿè®¡</h2>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-tests">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passed-tests">0</div>
                    <div class="stat-label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failed-tests">0</div>
                    <div class="stat-label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="success-rate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>
            <div class="progress-bar">
                <div id="test-progress" class="progress-fill" style="width: 0%"></div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æµ‹è¯•ç½‘æ ¼ -->
        <div class="test-grid">
            <!-- æ ¸å¿ƒç»„ä»¶æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ”§ æ ¸å¿ƒç»„ä»¶æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testUtils()">æµ‹è¯•å·¥å…·å‡½æ•°</button>
                    <button class="test-btn" onclick="testEventManager()">æµ‹è¯•äº‹ä»¶ç®¡ç†å™¨</button>
                    <button class="test-btn" onclick="testErrorLogger()">æµ‹è¯•é”™è¯¯æ—¥å¿—</button>
                    <button class="test-btn" onclick="testStorage()">æµ‹è¯•å­˜å‚¨ç®¡ç†</button>
                </div>
                <div id="core-status" class="status"></div>
            </div>
            
            <!-- åœ°å›¾åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ—ºï¸ åœ°å›¾åŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testMapLoading()">æµ‹è¯•åœ°å›¾åŠ è½½</button>
                    <button class="test-btn" onclick="testMapControls()">æµ‹è¯•åœ°å›¾æ§ä»¶</button>
                    <button class="test-btn" onclick="testMapMarkers()">æµ‹è¯•æ ‡è®°åŠŸèƒ½</button>
                    <button class="test-btn" onclick="testMapLayers()">æµ‹è¯•åœ°å›¾å›¾å±‚</button>
                </div>
                <div id="map-status" class="status"></div>
            </div>
            
            <!-- å®šä½åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ“ å®šä½åŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testGeolocation()">æµ‹è¯•GPSå®šä½</button>
                    <button class="test-btn" onclick="testLocationAccuracy()">æµ‹è¯•å®šä½ç²¾åº¦</button>
                    <button class="test-btn" onclick="testLocationTracking()">æµ‹è¯•è½¨è¿¹è®°å½•</button>
                    <button class="test-btn" onclick="testLocationError()">æµ‹è¯•å®šä½é”™è¯¯</button>
                </div>
                <div id="location-status" class="status"></div>
            </div>
            
            <!-- å¯¼èˆªåŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ§­ å¯¼èˆªåŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testRoutePlanning()">æµ‹è¯•è·¯çº¿è§„åˆ’</button>
                    <button class="test-btn" onclick="testNavigation()">æµ‹è¯•å¯¼èˆªç³»ç»Ÿ</button>
                    <button class="test-btn" onclick="testVoiceNavigation()">æµ‹è¯•è¯­éŸ³å¯¼èˆª</button>
                    <button class="test-btn" onclick="testDeviationHandling()">æµ‹è¯•åç¦»å¤„ç†</button>
                </div>
                <div id="navigation-status" class="status"></div>
            </div>
            
            <!-- AIåŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ¤– AIåŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDeepSeekAPI()">æµ‹è¯•DeepSeek API</button>
                    <button class="test-btn" onclick="testRouteAnalysis()">æµ‹è¯•è·¯çº¿åˆ†æ</button>
                    <button class="test-btn" onclick="testAISuggestions()">æµ‹è¯•AIå»ºè®®</button>
                    <button class="test-btn" onclick="testAILearning()">æµ‹è¯•AIå­¦ä¹ </button>
                </div>
                <div id="ai-status" class="status"></div>
            </div>
            
            <!-- å¤©æ°”åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸŒ¤ï¸ å¤©æ°”åŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testWeatherAPI()">æµ‹è¯•å¤©æ°”API</button>
                    <button class="test-btn" onclick="testWeatherAnalysis()">æµ‹è¯•å¤©æ°”åˆ†æ</button>
                    <button class="test-btn" onclick="testWeatherWarnings()">æµ‹è¯•å¤©æ°”é¢„è­¦</button>
                    <button class="test-btn" onclick="testWeatherCache()">æµ‹è¯•å¤©æ°”ç¼“å­˜</button>
                </div>
                <div id="weather-status" class="status"></div>
            </div>
            
            <!-- è·¯å†µç›‘æ§æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸš¦ è·¯å†µç›‘æ§æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testTrafficData()">æµ‹è¯•è·¯å†µæ•°æ®</button>
                    <button class="test-btn" onclick="testCongestionDetection()">æµ‹è¯•æ‹¥å µæ£€æµ‹</button>
                    <button class="test-btn" onclick="testRouteOptimization()">æµ‹è¯•è·¯çº¿ä¼˜åŒ–</button>
                    <button class="test-btn" onclick="testTrafficAlerts()">æµ‹è¯•è·¯å†µæé†’</button>
                </div>
                <div id="traffic-status" class="status"></div>
            </div>
            
            <!-- ç”¨æˆ·ç•Œé¢æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ¨ ç”¨æˆ·ç•Œé¢æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testResponsiveness()">æµ‹è¯•å“åº”å¼è®¾è®¡</button>
                    <button class="test-btn" onclick="testUIInteractions()">æµ‹è¯•ç•Œé¢äº¤äº’</button>
                    <button class="test-btn" onclick="testAccessibility()">æµ‹è¯•æ— éšœç¢åŠŸèƒ½</button>
                    <button class="test-btn" onclick="testAnimations()">æµ‹è¯•åŠ¨ç”»æ•ˆæœ</button>
                </div>
                <div id="ui-status" class="status"></div>
            </div>
            
            <!-- æ€§èƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3>âš¡ æ€§èƒ½æµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testLoadingSpeed()">æµ‹è¯•åŠ è½½é€Ÿåº¦</button>
                    <button class="test-btn" onclick="testMemoryUsage()">æµ‹è¯•å†…å­˜ä½¿ç”¨</button>
                    <button class="test-btn" onclick="testAPIPerformance()">æµ‹è¯•APIæ€§èƒ½</button>
                    <button class="test-btn" onclick="testBatteryUsage()">æµ‹è¯•ç”µé‡æ¶ˆè€—</button>
                </div>
                <div id="performance-status" class="status"></div>
            </div>
            
            <!-- é›†æˆæµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ”„ é›†æˆæµ‹è¯•</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testModuleIntegration()">æµ‹è¯•æ¨¡å—é›†æˆ</button>
                    <button class="test-btn" onclick="testDataFlow()">æµ‹è¯•æ•°æ®æµ</button>
                    <button class="test-btn" onclick="testEventHandling()">æµ‹è¯•äº‹ä»¶å¤„ç†</button>
                    <button class="test-btn" onclick="testErrorRecovery()">æµ‹è¯•é”™è¯¯æ¢å¤</button>
                </div>
                <div id="integration-status" class="status"></div>
            </div>
        </div>
        
        <!-- ä¸€é”®æµ‹è¯• -->
        <div class="test-card" style="margin-bottom: 20px;">
            <h3>ğŸš€ ä¸€é”®å…¨é¢æµ‹è¯•</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="test-btn success" onclick="runAllTests()" style="background: linear-gradient(135deg, #4CAF50, #45a049);">
                    è¿è¡Œæ‰€æœ‰æµ‹è¯•
                </button>
                <button class="test-btn warning" onclick="runCriticalTests()">
                    è¿è¡Œå…³é”®æµ‹è¯•
                </button>
                <button class="test-btn error" onclick="runPerformanceTests()">
                    è¿è¡Œæ€§èƒ½æµ‹è¯•
                </button>
                <button class="test-btn" onclick="clearResults()">
                    æ¸…é™¤ç»“æœ
                </button>
                <button class="test-btn" onclick="exportResults()">
                    å¯¼å‡ºæŠ¥å‘Š
                </button>
            </div>
        </div>
        
        <!-- æ§åˆ¶å°è¾“å‡º -->
        <div class="console-output" id="console-output">
            ç­‰å¾…æµ‹è¯•å¼€å§‹...\n
        </div>
    </div>

    <!-- åŠ è½½é…ç½®å’Œå·¥å…· -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/error-logger.js"></script>
    <script src="js/event-manager.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/map.js"></script>
    <script src="js/location.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/traffic-monitor.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // æµ‹è¯•ç»Ÿè®¡
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            results: []
        };
        
        // é‡å†™consoleè¾“å‡ºåˆ°é¡µé¢
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error,
            info: console.info
        };
        
        function addToConsole(message, type = 'info') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `console-log ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // ä¿æŒåŸå§‹consoleåŠŸèƒ½
            originalConsole[type](message);
        }
        
        console.log = function(...args) {
            addToConsole(args.join(' '), 'info');
        };
        
        console.warn = function(...args) {
            addToConsole(args.join(' '), 'warning');
        };
        
        console.error = function(...args) {
            addToConsole(args.join(' '), 'error');
        };
        
        console.info = function(...args) {
            addToConsole(args.join(' '), 'info');
        };
        
        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
            
            const progress = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('test-progress').style.width = progress + '%';
        }
        
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
                element.style.display = 'block';
                
                // 3ç§’åéšè—
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
        }
        
        // è¿è¡Œå•ä¸ªæµ‹è¯•
        async function runTest(testName, testFunction, statusElementId) {
            testStats.total++;
            
            try {
                console.log(`å¼€å§‹æµ‹è¯•: ${testName}`);
                const result = await testFunction();
                
                if (result === true || (result && result.success)) {
                    testStats.passed++;
                    testStats.results.push({ name: testName, status: 'passed', result: result });
                    console.log(`âœ… ${testName} - é€šè¿‡`);
                    showStatus(statusElementId, `${testName} - é€šè¿‡`, 'success');
                    return true;
                } else {
                    testStats.failed++;
                    testStats.results.push({ name: testName, status: 'failed', error: result });
                    console.error(`âŒ ${testName} - å¤±è´¥: ${result}`);
                    showStatus(statusElementId, `${testName} - å¤±è´¥: ${result}`, 'error');
                    return false;
                }
            } catch (error) {
                testStats.failed++;
                testStats.results.push({ name: testName, status: 'error', error: error.message });
                console.error(`âŒ ${testName} - å¼‚å¸¸: ${error.message}`);
                showStatus(statusElementId, `${testName} - å¼‚å¸¸: ${error.message}`, 'error');
                return false;
            } finally {
                updateStats();
            }
        }
        
        // å…·ä½“æµ‹è¯•å‡½æ•°
        async function testUtils() {
            if (!window.utils) {
                throw new Error('å·¥å…·æ¨¡å—æœªåŠ è½½');
            }
            
            // æµ‹è¯•åœ°ç†è®¡ç®—
            const point1 = { lat: 39.9042, lng: 116.4074 }; // åŒ—äº¬
            const point2 = { lat: 31.2304, lng: 121.4737 }; // ä¸Šæµ·
            const distance = window.utils.geo.calculateDistance(point1, point2);
            
            if (distance < 1000 || distance > 1500) {
                throw new Error(`è·ç¦»è®¡ç®—é”™è¯¯: ${distance}km (é¢„æœŸçº¦1067km)`);
            }
            
            // æµ‹è¯•æ—¶é—´æ ¼å¼åŒ–
            const date = new Date('2024-01-01 12:30:45');
            const formattedTime = window.utils.time.formatTime(date);
            if (formattedTime !== '12:30:45') {
                throw new Error(`æ—¶é—´æ ¼å¼åŒ–é”™è¯¯: ${formattedTime}`);
            }
            
            // æµ‹è¯•æ•°æ®éªŒè¯
            if (!window.utils.validation.isValidCoordinate(39.9042, 116.4074)) {
                throw new Error('åæ ‡éªŒè¯å¤±è´¥');
            }
            
            return { success: true, distance, formattedTime };
        }
        
        async function testEventManager() {
            if (!window.eventManager) {
                throw new Error('äº‹ä»¶ç®¡ç†å™¨æœªåŠ è½½');
            }
            
            let eventReceived = false;
            
            // æµ‹è¯•äº‹ä»¶ç›‘å¬
            const listenerId = window.eventManager.on('test:event', (event) => {
                eventReceived = true;
            });
            
            // æµ‹è¯•äº‹ä»¶è§¦å‘
            window.eventManager.emit('test:event', { test: 'data' });
            
            // æ¸…ç†
            window.eventManager.off('test:event', listenerId);
            
            if (!eventReceived) {
                throw new Error('äº‹ä»¶æœªæ­£ç¡®æ¥æ”¶');
            }
            
            return { success: true };
        }
        
        async function testErrorLogger() {
            if (!window.errorLogger) {
                throw new Error('é”™è¯¯æ—¥å¿—æ¨¡å—æœªåŠ è½½');
            }
            
            // æµ‹è¯•æ—¥å¿—è®°å½•
            window.errorLogger.info('æµ‹è¯•ä¿¡æ¯æ—¥å¿—');
            window.errorLogger.warn('æµ‹è¯•è­¦å‘Šæ—¥å¿—');
            
            // æ£€æŸ¥æ—¥å¿—æ˜¯å¦è®°å½•
            const logs = window.errorLogger.getLogs();
            if (logs.length === 0) {
                throw new Error('æ—¥å¿—æœªè®°å½•');
            }
            
            return { success: true, logCount: logs.length };
        }
        
        async function testStorage() {
            if (!window.dataManager) {
                throw new Error('æ•°æ®ç®¡ç†å™¨æœªåŠ è½½');
            }
            
            // æµ‹è¯•æ•°æ®å­˜å‚¨
            const testData = { test: 'value', timestamp: Date.now() };
            window.dataManager.storage.set('test_key', testData);
            
            // æµ‹è¯•æ•°æ®è¯»å–
            const retrievedData = window.dataManager.storage.get('test_key');
            if (!retrievedData || retrievedData.test !== testData.test) {
                throw new Error('æ•°æ®å­˜å‚¨/è¯»å–å¤±è´¥');
            }
            
            // æ¸…ç†æµ‹è¯•æ•°æ®
            window.dataManager.storage.remove('test_key');
            
            return { success: true };
        }
        
        async function testMapLoading() {
            if (typeof T === 'undefined') {
                throw new Error('å¤©åœ°å›¾APIæœªåŠ è½½');
            }
            
            // æµ‹è¯•åœ°å›¾åˆå§‹åŒ–
            const testContainer = document.createElement('div');
            testContainer.id = 'test-map';
            testContainer.style.width = '100px';
            testContainer.style.height = '100px';
            document.body.appendChild(testContainer);
            
            try {
                const map = new T.Map('test-map');
                const center = new T.LngLat(116.404, 39.915);
                map.centerAndZoom(center, 10);
                
                // æ¸…ç†
                document.body.removeChild(testContainer);
                
                return { success: true };
            } catch (error) {
                // æ¸…ç†
                if (testContainer.parentNode) {
                    document.body.removeChild(testContainer);
                }
                throw error;
            }
        }
        
        async function testGeolocation() {
            if (!navigator.geolocation) {
                throw new Error('æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½');
            }
            
            return new Promise((resolve, reject) => {
                const timeout = setTimeout(() => {
                    reject(new Error('å®šä½è¶…æ—¶'));
                }, 5000);
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        clearTimeout(timeout);
                        resolve({ success: true, position });
                    },
                    (error) => {
                        clearTimeout(timeout);
                        reject(new Error(`å®šä½å¤±è´¥: ${error.message}`));
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 60000
                    }
                );
            });
        }
        
        async function testDeepSeekAPI() {
            if (!CONFIG.API.DEEPSEEK.API_KEY) {
                throw new Error('DeepSeek APIå¯†é’¥æœªé…ç½®');
            }
            
            try {
                const response = await fetch(`${CONFIG.API.DEEPSEEK.BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.API.DEEPSEEK.API_KEY}`
                    },
                    body: JSON.stringify({
                        model: CONFIG.API.DEEPSEEK.MODEL,
                        messages: [
                            {
                                role: 'user',
                                content: 'è¯·å›å¤"æµ‹è¯•æˆåŠŸ"'
                            }
                        ],
                        max_tokens: 10
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                if (!data.choices || data.choices.length === 0) {
                    throw new Error('APIå“åº”æ ¼å¼é”™è¯¯');
                }
                
                return { success: true, response: data };
            } catch (error) {
                throw new Error(`DeepSeek APIæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testRouteAnalysis() {
            if (!window.aiAssistant) {
                throw new Error('AIåŠ©æ‰‹æœªåˆå§‹åŒ–');
            }
            
            const testRouteData = {
                totalDistance: 100,
                estimatedTime: 3600,
                waypoints: [
                    { name: 'èµ·ç‚¹', distance: 0 },
                    { name: 'ç»ˆç‚¹', distance: 100 }
                ]
            };
            
            try {
                const analysis = await window.aiAssistant.analyzeRoute(testRouteData);
                if (!analysis || typeof analysis.difficulty !== 'number') {
                    throw new Error('è·¯çº¿åˆ†æè¿”å›æ ¼å¼é”™è¯¯');
                }
                
                return { success: true, analysis };
            } catch (error) {
                throw new Error(`è·¯çº¿åˆ†ææµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testWeatherAPI() {
            if (!window.weatherManager) {
                throw new Error('å¤©æ°”ç®¡ç†å™¨æœªåˆå§‹åŒ–');
            }
            
            try {
                // æ¨¡æ‹Ÿå¤©æ°”æ•°æ®è·å–
                const testLocation = { lat: 39.9042, lng: 116.4074 };
                const weatherData = await window.weatherManager.getCurrentWeather(testLocation);
                
                // è¿™é‡Œåªæµ‹è¯•APIè°ƒç”¨ç»“æ„ï¼Œä¸ä¾èµ–çœŸå®API
                return { success: true, weather: weatherData || 'mock_data' };
            } catch (error) {
                throw new Error(`å¤©æ°”APIæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testVoiceNavigation() {
            if (!window.navigationManager) {
                throw new Error('å¯¼èˆªç®¡ç†å™¨æœªåˆå§‹åŒ–');
            }
            
            // æµ‹è¯•è¯­éŸ³åŠŸèƒ½
            if (!('speechSynthesis' in window)) {
                throw new Error('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
            }
            
            try {
                // æµ‹è¯•è¯­éŸ³åˆå§‹åŒ–
                const voices = window.speechSynthesis.getVoices();
                const chineseVoice = voices.find(voice => 
                    voice.lang.includes('zh') || voice.lang.includes('CN')
                );
                
                return { 
                    success: true, 
                    voiceCount: voices.length,
                    hasChineseVoice: !!chineseVoice
                };
            } catch (error) {
                throw new Error(`è¯­éŸ³å¯¼èˆªæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            const testGroups = [
                { name: 'æ ¸å¿ƒç»„ä»¶', tests: [
                    { name: 'å·¥å…·å‡½æ•°', fn: testUtils, id: 'core-status' },
                    { name: 'äº‹ä»¶ç®¡ç†å™¨', fn: testEventManager, id: 'core-status' },
                    { name: 'é”™è¯¯æ—¥å¿—', fn: testErrorLogger, id: 'core-status' },
                    { name: 'å­˜å‚¨ç®¡ç†', fn: testStorage, id: 'core-status' }
                ]},
                { name: 'åœ°å›¾åŠŸèƒ½', tests: [
                    { name: 'åœ°å›¾åŠ è½½', fn: testMapLoading, id: 'map-status' }
                ]},
                { name: 'å®šä½åŠŸèƒ½', tests: [
                    { name: 'GPSå®šä½', fn: testGeolocation, id: 'location-status' }
                ]},
                { name: 'AIåŠŸèƒ½', tests: [
                    { name: 'DeepSeek API', fn: testDeepSeekAPI, id: 'ai-status' },
                    { name: 'è·¯çº¿åˆ†æ', fn: testRouteAnalysis, id: 'ai-status' }
                ]},
                { name: 'å¤©æ°”åŠŸèƒ½', tests: [
                    { name: 'å¤©æ°”API', fn: testWeatherAPI, id: 'weather-status' }
                ]},
                { name: 'å¯¼èˆªåŠŸèƒ½', tests: [
                    { name: 'è¯­éŸ³å¯¼èˆª', fn: testVoiceNavigation, id: 'navigation-status' }
                ]}
            ];
            
            for (const group of testGroups) {
                console.log(`\nğŸ“‹ æµ‹è¯•ç»„: ${group.name}`);
                for (const test of group.tests) {
                    await runTest(test.name, test.fn, test.id);
                    await new Promise(resolve => setTimeout(resolve, 100)); // çŸ­æš‚å»¶è¿Ÿ
                }
            }
            
            console.log('\nğŸ“Š æµ‹è¯•å®Œæˆï¼Œç”ŸæˆæŠ¥å‘Š...');
            generateTestReport();
        }
        
        // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        function generateTestReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testStats.total,
                    passed: testStats.passed,
                    failed: testStats.failed,
                    successRate: testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0
                },
                details: testStats.results,
                environment: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    url: window.location.href
                }
            };
            
            console.log('\nğŸ“‹ æµ‹è¯•æŠ¥å‘Š:');
            console.log(`æ€»æµ‹è¯•æ•°: ${report.summary.total}`);
            console.log(`é€šè¿‡: ${report.summary.passed}`);
            console.log(`å¤±è´¥: ${report.summary.failed}`);
            console.log(`æˆåŠŸç‡: ${report.summary.successRate}%`);
            
            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            console.log('\nğŸ“ è¯¦ç»†ç»“æœ:');
            testStats.results.forEach(result => {
                const status = result.status === 'passed' ? 'âœ…' : 'âŒ';
                console.log(`${status} ${result.name}: ${result.error || 'é€šè¿‡'}`);
            });
            
            return report;
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            testStats = {
                total: 0,
                passed: 0,
                failed: 0,
                results: []
            };
            updateStats();
            
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.innerHTML = 'ç­‰å¾…æµ‹è¯•å¼€å§‹...\n';
            
            // éšè—æ‰€æœ‰çŠ¶æ€
            document.querySelectorAll('.status').forEach(status => {
                status.style.display = 'none';
            });
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            const report = generateTestReport();
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-report-${new Date().toISOString().slice(0, 19)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        // ç®€åŒ–çš„å…³é”®æµ‹è¯•
        async function runCriticalTests() {
            console.log('ğŸ”¥ è¿è¡Œå…³é”®æµ‹è¯•...');
            
            const criticalTests = [
                { name: 'å·¥å…·å‡½æ•°', fn: testUtils, id: 'core-status' },
                { name: 'DeepSeek API', fn: testDeepSeekAPI, id: 'ai-status' },
                { name: 'GPSå®šä½', fn: testGeolocation, id: 'location-status' }
            ];
            
            for (const test of criticalTests) {
                await runTest(test.name, test.fn, test.id);
            }
        }
        
        // æ€§èƒ½æµ‹è¯•
        async function runPerformanceTests() {
            console.log('âš¡ è¿è¡Œæ€§èƒ½æµ‹è¯•...');
            
            const performanceTests = [
                { name: 'å·¥å…·å‡½æ•°', fn: testUtils, id: 'performance-status' }
            ];
            
            for (const test of performanceTests) {
                await runTest(test.name, test.fn, test.id);
            }
        }
        
        // æ·»åŠ å…¶ä»–æµ‹è¯•å‡½æ•°çš„ç©ºå®ç°ï¼Œé¿å…JavaScripté”™è¯¯
        const testFunctions = [
            'testMapControls', 'testMapMarkers', 'testMapLayers',
            'testLocationAccuracy', 'testLocationTracking', 'testLocationError',
            'testRoutePlanning', 'testNavigation', 'testDeviationHandling',
            'testAISuggestions', 'testAILearning',
            'testWeatherAnalysis', 'testWeatherWarnings', 'testWeatherCache',
            'testTrafficData', 'testCongestionDetection', 'testRouteOptimization', 'testTrafficAlerts',
            'testResponsiveness', 'testUIInteractions', 'testAccessibility', 'testAnimations',
            'testLoadingSpeed', 'testMemoryUsage', 'testAPIPerformance', 'testBatteryUsage',
            'testModuleIntegration', 'testDataFlow', 'testEventHandling', 'testErrorRecovery'
        ];
        
        testFunctions.forEach(fnName => {
            window[fnName] = async function() {
                await runTest(fnName.replace('test', ''), () => {
                    return { success: true, message: 'åŠŸèƒ½å¾…å®ç°' };
                }, 'status');
            };
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('ğŸ¯ æ™ºèƒ½éª‘è¡ŒåŠ©æ‰‹åŠŸèƒ½æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹å…¨é¢æµ‹è¯•');
            
            // åˆå§‹åŒ–ç»Ÿè®¡
            updateStats();
        });
    </script>
</body>
</html>